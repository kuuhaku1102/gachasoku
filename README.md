# Gachasoku Theme Enhancements

このテーマには管理画面から更新できるコンテンツ管理機能が多数実装されています。以下の機能概要と利用手順を参考に、サイト運用を効率化してください。

## ランキング管理
- 管理画面左メニューの「ランキング管理」から順位・画像・本文・詳細／公式ボタンなどを設定できます。
- 「項目を追加」で複数行を登録でき、ドラフト保存後にランキングページやショートコードから参照されます。
- ランキング表示は以下の 2 通りに対応しています。
  - 固定ページでテンプレート「ランキングページ」を選択する。
  - 本文にショートコード `[gachasoku_ranking title="見出し" lead="リード文"]` を挿入する。

## アーカイブページ
- `archive.php` では PC 3 列／スマートフォン 2 列のカード型レイアウトで投稿一覧を表示します。
- サムネイル・タイトル・抜粋・詳細ボタンがカード内に配置され、視認性の高いアーカイブページを提供します。

## カレンダー管理
- 管理画面の「カレンダー管理」から単発・期間・毎月・曜日指定などのイベントを登録できます。
- 投稿／固定ページ編集画面にはイベント一覧コピー用メタボックスが表示されます。
- ショートコード `[gachasoku_calendar]` または `[gachasoku_calendar month="YYYY-MM"]` で月間カレンダーを表示できます。
- 当日イベントがある場合はカレンダー下部にピックアップボタンが自動表示されます。

## アフィリエイトリンク置換
- 「リンク置換管理」でルートドメインと置換先 URL をペアで登録すると、サイト内の該当リンクを自動でアフィリエイト URL に差し替えます。
- 例: `oripa.ex-toreca.com` → `https://online-gacha-hack.com/e13e` を登録すると、該当ドメインを含むリンクはすべて後者にリダイレクトします。
- ランキング・カレンダー・投稿本文など、テーマ全体のリンクに適用されます。必要なドメインを追加した後、「リンク設定を保存」をクリックして更新してください。


## 会員・キャンペーン管理
- テーマ有効化時に自動で会員用テーブルと「gachasoku_member」ロールが作成されます。既存会員のステータスは「有効」が初期値です。
- 管理者は左メニューの「会員管理」から会員の検索／ステータス変更（有効・停止・退会済）／削除ができます。個別プロフィール編集画面へのショートカットも用意しています。
- 同メニュー配下の「抽選管理」で各キャンペーンの応募状況を確認し、当選人数の指定・再抽選・履歴確認が可能です。抽選履歴は自動で保存されます。

### 会員向けフロントエンド
- 会員登録フォーム: `[gachasoku_register_form]`
- ログインフォーム: `[gachasoku_login_form]`
- パスワード再設定フォーム: `[gachasoku_password_reset_form]`
- マイページ／応募状況: `[gachasoku_member_dashboard]`
- いずれも WordPress の固定ページなどにショートコードを貼り付けるだけで利用でき、エラーメッセージはテーマ内で整形されます。

### キャンペーン運用
- 管理画面の投稿タイプ「キャンペーン」からタイトル・本文に加えて以下のメタ情報を登録できます。
  - 応募期間（開始／終了日時）
  - 外部リンク URL（ルートドメイン置換機能が自動適用）
  - キャンペーン画像
  - 応募条件の説明文
  - 当選人数（抽選画面の初期値）
- フロント側ではショートコード `[gachasoku_campaigns]` でキャンペーン一覧を表示できます。`status="open"` または `status="closed"` を付与すると応募受付中／終了済みで絞り込みが可能です。
- ログイン済みでステータスが「有効」の会員のみ応募ボタンが表示され、応募履歴はマイページに自動反映されます。非ログインユーザーは内容を閲覧できますが応募はできません。
- 抽選結果のステータス（当選・落選）はマイページの「当選結果」セクションに表示され、抽選管理画面で再抽選した場合も自動更新されます。
